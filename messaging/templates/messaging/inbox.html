{% extends "base.html" %}
{% load static %}

<!-- groupchat app css links -->
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'group_chat/css/summernote.css' %}"> 
    <link href="{% static 'group_chat/css/emoji.css' %}" rel="stylesheet">
    <link href="{% static 'messaging/css/messaging.css' %}" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

{% endblock %}

{% block content %}
<div class="w-100 h-100 d-flex flex-dir-row">
    <div class="inbox-container">
            <div class="inbox-categories">
                <div data-toggle="tab" data-target="#inbox" class="active"> Inbox </div>
                <div data-toggle="tab" data-target="#sent"> Sent </div>
                <div data-toggle="tab" data-target="#marked"> Marked </div>
                <div data-toggle="tab" data-target="#drafts"> Drafts </div>
            </div>
            <div class="tab-content">
                <div id="inbox" class="tab-pane active">
                    <form class="panel-search-form info form-group has-feedback no-margin-bottom">
                        <input type="text" class="form-control" name="search" placeholder="Search">
                        <span class="fa fa-search form-control-feedback"></span>
                    </form>
                    <div class="contacts-outter">
                        <ul class="list-unstyled contacts">
                            {% for message in messages %}
                                <li class="message-link " data-userid="{% if messsage.sender == user %}{{ message.receiver.id}}{% else %}{{ message.sender.id }}{% endif %}" data-toggle="tab" data-target="#inbox-message-1" data-url="{% url 'message_list' sender_id=message.sender.id receiver_id=message.receiver.id %}" >
                                    <div class="img-count">
                                        <div class="message-count"> 1</div>
                                        {%if message.sender.userprofile.profile_picture %}
                                        <img alt="" class="img-circle medium-image" src="{{ message.sender.userprofile.profile_picture.url }}">
                                         {% endif %} </h4>
                                    </div>
                                    <div class="vcentered info-combo">
                                        <h3 class="no-margin-bottom name"> {% if message.sender == user %}{{ message.receiver.username }}{% else %}{{ message.sender.username }}{% endif %}</h3>
                                        <h5> {{ message.content}}</h5>
                                    </div>
                                    <div class="contacts-add">
                                        <span class="message-time">
                                            {% now "Y-m-d" as current_datetime %}             
                                            {% with message_date=message.timestamp%}
                                                {% if message_date|date:"Y-m-d" == current_datetime %}
                                                    {{ message_date|date:"H:i"|upper }} <!-- Display time -->
                                                {% else %}
                                                    {{ message_date|date:"M j"|upper }} <!-- Display date -->
                                                {% endif %}
                                            {% endwith %}
                                        </span>
                                        <i class="fa fa-trash-o"></i>
                                        <i class="fa fa-paperclip"></i>
                                    </div>
                                </li>
                            {% endfor %}  
                        </ul>
                    </div>
                </div>
                <div id="sent" class="tab-pane">
                    <form class="panel-search-form success form-group has-feedback no-margin-bottom">
                        <input type="text" class="form-control" name="search" placeholder="Search">
                        <span class="fa fa-search form-control-feedback"></span>
                    </form>
                    <div class="contacts-outter">
                        <ul class="list-unstyled contacts success">
                            <li data-toggle="tab" data-target="#sent-message-1">
                                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                                <div class="vcentered info-combo">
                                    <h3 class="no-margin-bottom name"> David Beckham </h3>
                                    <h5> I would like to take a look at it this evening, is it possible ? </h5>
                                </div>
                                <div class="contacts-add">
                                    <span class="message-time"> 2:24 <sup>AM</sup></span>
                                    <i class="fa fa-trash-o"></i>
                                    <i class="fa fa-paperclip"></i>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="marked" class="tab-pane">
                    <form class="panel-search-form warning form-group has-feedback no-margin-bottom">
                        <input type="text" class="form-control" name="search" placeholder="Search">
                        <span class="fa fa-search form-control-feedback"></span>
                    </form>
                    <div class="contacts-outter">
                        <ul class="list-unstyled contacts warning">
                            <li data-toggle="tab" data-target="#marked-message-1">

                                    <div class="message-count"> 2 </div>
                                    <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                                    <div class="vcentered info-combo">
                                        <h3 class="no-margin-bottom name"> Jessica Franco </h3>
                                        <h5> Hello, Dennis. I wanted to let you know we reviewed your proposal and decided  </h5>
                                    </div>
                                <div class="contacts-add">
                                    <span class="message-time"> 1:44 <sup>AM</sup></span>
                                    <i class="fa fa-trash-o"></i>
                                    <i class="fa fa-paperclip"></i>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="drafts" class="tab-pane">
                    <form class="panel-search-form dark form-group has-feedback no-margin-bottom">
                        <input type="text" class="form-control" name="search" placeholder="Search">
                        <span class="fa fa-search form-control-feedback"></span>
                    </form>
                    <div class="contacts-outter">
                        <ul class="list-unstyled contacts dark">
                            <li data-toggle="tab" data-target="#draft-message-1">
                                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                                <div class="vcentered info-combo">
                                    <h3 class="no-margin-bottom name"> Milla Shiffman </h3>
                                    <h5> Hello, Mila, can you send me the latest pack of icons, I need </h5>
                                </div>
                                <div class="contacts-add">
                                    <span class="message-time"> 4:22 <sup>AM</sup></span>
                                    <i class="fa fa-trash-o"></i>
                                    <i class="fa fa-paperclip"></i>
                                </div>
                            </li>
                        </ul>
                    </div>
            </div>
        </div>
    </div>

    <!-- container where posts get loaded into with ajax -->
    <div id="messages-list-container" class=" w-100 d-flex flex-column justify-content-between"></div>

    <!-- container where comments get loaded into with ajax -->
    <div id='message-list-thread' class ="comments-container flex-column justify-content-between"></div>

</div>
{% endblock %}


{% block postloadjs %}
    <!-- group chat app scripts  -->
    <script src="{% static 'group_chat/js/config.js' %}"></script>
    <script src="{% static 'group_chat/js/tam-emoji.js' %}"></script>
    <script src="{% static 'group_chat/js/summernote.js' %}"></script>



    <script>     

        $('.message-link').on('click', function(e){
            e.preventDefault()
            let url = $(this).data('url')

            ajaxRequest(url, null, 'GET', '#messages-list-container', null, function(response){
                $('#messages-list-container').html(response)
                //autoScroll()
            })
        })
        {% if new_message %}
            $('.message-link:last').click()
        {% elif receiver %}
            $('.message-link[data-userid="{{ receiver.id }}"]').click();
        {% endif %}
    //$(document).ready(function() {
        // check if the id for the channel the user last visited exists
        // if it does load posts
            // if(window.innerWidth > 575){
            //     ajaxRequest(lastViewedurl, null, 'GET', '#channel-posts', null, function(response){
            //         $('#channel-posts').html(response)
            //         autoScroll()
            //     })
            //     $('#channel-posts').addClass('d-flex');
            // }
        //         

        //         ajaxRequest(savedPostChannel, null, 'GET', '#channel-posts', null, function(response){
        //             $('#channel-posts').html(response)
        //             autoScroll(null, {{ post_id }})

        //         })
        //         if(window.innerWidth < 575.5){
        //             $('#nav-bar').addClass('d-none')
        //             $('header').addClass('d-none')
        //             $('#channel-links-container').addClass('d-none');
        //         }
               
        //         $('#channel-posts').addClass('d-flex');
        //
        // //url for emojis spritesheet
        // 
        // summernoteEnhancerEditPost.init('.edit-post .card-body', editPostUrl, csrfToken)


    </script>

{% endblock %}